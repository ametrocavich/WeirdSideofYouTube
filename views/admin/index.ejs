<!DOCTYPE html>
<html>
<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js'></script>
<!-- <link rel="stylesheet" type="text/css" href="./style.css"> -->
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
<body>

<form action="/admin/submit" method="post" class="pure-form">
	<span>
	<label>Video ID:</label>
	<input type="text" name="videoID"/>
	<input type="submit" value="Submit" class="pure-button"/>
	</span>
</form>

<form action="/admin/remove" method="post" class="pure-form">
	<span>
	<label>Video ID:</label>
	<input type="text" name="videoID"/>
	<input type="submit" value="Remove" class="pure-button"/>
	</span>
</form>

<form action="/admin/crawlreddit" method="get" class="pure-form">
	<input type="submit" value="Crawl /r/DeepIntoYoutube" class="pure-button"/>
	</span>
</form>

<table id="videoTable" cellspacing="5" class="pure-table">
	<tr id="tableheader">
	   <th>Controls</th>
	   <!-- The stats button should expand and show full statistics for a video.  We can hide some of the stats that show by default, or add more -->
	   <th>ID</th>
	   <th>Thumbnail</th>
	   <th>Title</th>
	   <th>Views</th>
	   <th>Skip %</th>
	   <th>Error %</th>
 	</tr>
</table>

<br />

<input id="previousbutton" type="button" value="Previous">
<input id="nextbutton" type="button" value="Next">

<br />

<script type="text/javascript">
	var currentVideoID = 1;
	// XXX TODO make some config file where the user can specify their key
	// XXX Remove our API key from the repo, and possible switch to OAuth
	var youtubeAPIKey = "AIzaSyBf-B5_3Iz5a8Ij52BioFPOE4xJLqC9Sy8";

	function loadNewTable(){
		$('#videoTable tr').remove(".videoRow");
		$.getJSON("/admin/getvidrange/" + currentVideoID.toString() + "/" + (currentVideoID + 49).toString(), function(videos) {
			$.each(videos, function(key, value) {
				$('<tr id="' + value.videoID + '" class="videoRow">').append(
					$('<td>').append(
						$('<form>').attr({"action": "/admin/remove", "method": "post"}).append(
							$('<input>').attr({"type": "hidden", "name": "videoID", "value": "value.videoID"}),
							$('<input>').attr({"type": "submit", "value": "Delete Video"})
						)
					),
					$('<td>').text(value.videoID),
					$('<td>').html('<img src="//i.ytimg.com/vi/' + value.videoID + '/default.jpg" />'),
					$('<td>').attr("id", "title"),
					$('<td>').text(value.views),
					$('<td>').text(value.skips/value.views*100 + "%"),
					$('<td>').text(value.errorCount/value.views*100 + "%")
				).appendTo( "#videoTable" );
				$.getJSON("https://www.googleapis.com/youtube/v3/videos?part=snippet&id=" + value.videoID + "&key=" + youtubeAPIKey, function(data) {
					$('#videoTable').find('#'+value.videoID).find('#title').text(data.items[0].snippet.title);
				});
			});
		});
	}

	loadNewTable();
	 
	 $('#nextbutton').click(function(){	
		currentVideoID += 50;
		loadNewTable();
	 });
	 
	 $('#previousbutton').click(function(){
		currentVideoID -= 50;
		if(currentVideoID < 1){
			currentVideoID = 1;
		}
			loadNewTable();
	 });
</script>

</body>
</html>
